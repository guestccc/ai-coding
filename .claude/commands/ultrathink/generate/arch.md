# /ut:generate/arch

**命令描述**: 调用架构师Agent生成技术架构文档
**交互消耗**: 🟡 中消耗 (3-4次)
**激活Agent**: architect.md

## 命令用法

```bash
/ut:generate/arch [基于PRD]
```

## 前置依赖

- ✅ 必须存在: `docs/PRD.md`
- 📋 建议存在: `project/context/requirements.md`

## 执行流程

### 1. PRD分析阶段
- **输入**: @docs/PRD.md 产品需求文档
- **处理**: 提取技术约束、性能要求、集成需求
- **输出**: 技术需求清单

### 2. 技术选型阶段
使用技术选型评估矩阵：
```yaml
评估维度:
  功能适配度 (30%): 需求覆盖、功能完整性、扩展性
  开发效率 (25%): 学习成本、开发速度、生态支持
  性能表现 (20%): 运行性能、内存占用、构建速度
  维护成本 (15%): 社区活跃度、长期支持、迁移成本
  团队匹配 (10%): 技术栈熟悉度、培训成本、人力资源
```

### 3. 架构设计阶段
分层架构设计：
- **表现层**: React 18 + TypeScript + Vite + Tailwind
- **应用层**: Express.js + 中间件设计 + 路由策略
- **业务层**: 服务层设计 + 领域模型 + 事务管理
- **数据层**: Prisma ORM + 数据库设计 + 缓存策略

### 4. 系统集成设计
- **认证授权**: JWT + 权限控制
- **API设计**: RESTful + OpenAPI规范
- **数据流**: 前后端数据交互模式
- **部署架构**: Docker + Nginx配置

## 输出文件

**主要输出**: `docs/architecture.md`
```yaml
文档结构:
  1. 架构概述
  2. 技术栈选择  
  3. 系统架构图
  4. 分层设计
  5. 数据库设计
  6. API设计原则
  7. 非功能性设计
  8. 部署架构
  9. 风险评估
```

**次要输出**:
- `project/context/tech-decisions.md` - 技术决策记录
- `project/context/architecture-adr.md` - 架构决策记录

## Agent协作

**上游输入**: 
- ← product-manager.md (PRD文档)

**下游输出**:
- → frontend-developer.md (前端架构规范)
- → backend-developer.md (后端架构规范)
- → integration.md (集成架构要求)

## 架构模式选择

基于项目复杂度选择合适架构：
```yaml
简单项目: MVC模式 (快速开发)
中等复杂: 分层架构 (职责清晰)  
复杂系统: 领域驱动设计DDD简化版
超大系统: 微服务架构 (需评估成本)
```

## 质量标准

- ✅ 技术选型有明确评估依据
- ✅ 架构图清晰展示组件关系
- ✅ 数据库设计符合3NF规范化
- ✅ API设计遵循RESTful原则
- ✅ 非功能性需求有具体指标
- ✅ 部署架构支持横向扩展

## 示例用法

```bash
# 基于现有PRD生成架构
/ut:generate/arch

# 指定特殊约束
/ut:generate/arch "高并发+微服务架构"
```

## 最佳实践

1. **架构简洁性**: 符合KISS原则，避免过度设计
2. **技术成熟度**: 优先选择成熟稳定的技术栈
3. **扩展性考虑**: 预留接口和扩展点
4. **性能设计**: 关键路径性能优化预案